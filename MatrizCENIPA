#DP Definindo o endereço das planilhas
path<-"/Users/jcaetano/Dropbox/Trabalho/Inframerica/MatrizDeTransecto/TabelasAnalise"
setwd(path)
trans<-"Transecto.txt"
reg<-"Registro.txt"

#Inserindo os dados sobre colisões
colisoes<-read.table("DadosColisoes.txt", header=TRUE)

#Inserindo tabela de abreviações
abreviacoes<-read.table("AbrevSP.txt",header=TRUE)

##Organizando as planilhas de dados
#Lendo a planilha
Transecto<-read.table(trans, header=T)
Registro<-read.table(reg, header=T)
#Juntado duas planilhas
dados<-merge(Transecto,Registro,by.x="TRANSEC", by.y="TRANSEC")

#1
###Calculando a informação de frequência de Colisões
#Identificando a variável de data
colisoes$Data<-as.Date(colisoes$Data,format="%Y-%m-%d")
#Adicionando a coluna de abreviações
MColisoes<-merge(colisoes,abreviacoes,by.x="SP",by.y="Nome",all.x=TRUE)
#Criando uma coluna numerica para se calcular o número de colunas
n<-nrow(MColisoes)
count<-rep(1,n)
MColisoes<-cbind(MColisoes,count)

#2
#Selecionando apenas as colisões para os ultimos 5 anos em brasilia
d5<-subset(MColisoes,Data>"2013-11-08")
(Selecionar os dados para colisoes de Brasília)

#Identificando os dados de data
dados$DATA<-as.Date(dados$DATA,format="%Y-%m-%d")
#Selecionando Transectos realizados a cima de 2015
dados2<-subset(dados,DATA>"2015-12-31")

##"A" Abundancia média por espécie
#Somatório de individuos por transecto
tot<-aggregate(dados2$QUANT,list(dados2$TRANSECR,dados2$CodEspecie),FUN=sum)
#media por especie
##Removendo os nas
tot<-na.omit(tot)
A<-aggregate(tot$x,list(tot$Group.2),FUN=mean)
##"B" Massa média para cada espécie
#Medida da massa para cada espécie
DadosBasicos<-read.table("DadosBasicos.txt", header=T)
B<-data.frame(DadosBasicos[c(2,4)])

###Massa Total de Indivíduos
MT<-A*B

#3
##Permanencia no Aerodromo
tab<-table(dados2$CodEspecie,dados2$TRANSECR)
tab<-1*(tab>0)
n<-ncol(tab)
tab<-data.frame(rowSums(tab))
D<-tab/n
D$Group.1<-rownames(D)

#4 
##Proporção de Colisões com dano

#5
##Severidade Relativa

#6
##Proporção de colisões multiplas


